/*
 * VGA.c
 *
 *  Created on: Mar 27, 2022
 *      Author: mlokh
 */

#include "altera_up_avalon_video_dma_controller.h"
#include "VGA.h"
#include <stdio.h>
#include <string.h>

int screen_col;
int screen_row;
int text_col;
int text_row;

alt_up_video_dma_dev* vid_dev;
alt_up_video_dma_dev* char_dev;


int VGA_driver() {
	  vid_dev = alt_up_video_dma_open_dev(VIDEO_IN_SUBSYSTEM_VIDEO_IN_DMA_NAME);
	  char_dev = alt_up_video_dma_open_dev("/dev/VGA_Subsystem_Char_Buf_Subsystem_Char_Buf_DMA");

	  alt_up_video_dma_screen_clear(vid_dev, 0);
	  alt_up_video_dma_screen_clear(char_dev, 0);

	  init_numpad_array();
	  print_numpad_array();
	  draw_numpad();

	  printf ("\nExiting program\n");
	  return 0;
}

void print_numpad_array(void) {
  int i;
  for (i = 0; i < NUM_KEYS; i++) {
    printf("%s, ", str_numpad[i]);
  }
  printf("\n");
}

void init_numpad_array(void) {
  int index;
  int number = 1;
  char str_num[STRING_SIZE] = "\0";

  /* First 3 strings 0 enter clear */
  strcpy(str_numpad[0], "0\0");
  strcpy(str_numpad[1], "Enter\0");
  strcpy(str_numpad[2], "clear\0");

  for (index = 3; index < NUM_KEYS; index++) {
    sprintf(str_num, "%d", number);
    strcpy(str_numpad[index], str_num);
    number++;
  }

  printf("\nInitialized numpad_array, up to number %d\n", number -1);
}

void draw_numpad(void) {
  int i;

  int col = START_COL;
  int row = START_ROW;

  int text_col = TXT_START_COL;
  int text_row = TXT_START_ROW;

  for (i = NUM_KEYS - 1; i >= 0; i--) {

    draw_numpad_box(col,row, text_col, text_row, str_numpad[i]);

    if (i % 3 == 0) {
      col = START_COL;
      row += SCALAR;
      text_col = TXT_START_COL;
      text_row += TXT_SCALAR;
    } else {
      col -= SCALAR;
      text_col -= TXT_SCALAR;
    }
  }
}

void draw_numpad_box(int col, int row, int text_col, int text_row, char *str) {
  int scalar = SCALAR;
  alt_up_video_dma_draw_box(vid_dev, 255, col + 2, row + 2, col + scalar - 2, row + scalar - 2, 0, 1);
  alt_up_video_dma_draw_string(char_dev, str, text_col, text_row, 0);
}


